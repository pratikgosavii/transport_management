{% extends 'expense/base_main.html' %}


{% block title %}Submit{% endblock title %}

{% block breadcrumbs %}
{% endblock breadcrumbs %}

{% block head %}


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>    <!-- imp -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.min.js"></script> 


<style>

    




    
    .select2-container {
        min-width: 200px !important;
     }
     

     

     .selection{
       height: 50px;
   display: grid;
     }


     .select2-results__option {
       padding-right: 20px;
       vertical-align: middle;
     }
     .select2-results__option:before {
       content: "";
       display: inline-block;
       position: relative;
       height: 20px;
       width: 20px;
       border: 2px solid #e9e9e9;
       border-radius: 4px;
       background-color: #fff;
       margin-right: 20px;
       vertical-align: middle;
     }
     .select2-results__option[aria-selected=true]:before {
       font-family:fontAwesome;
       content: "\f00c";
       color: #fff;
       background-color: #f77750;
       border: 0;
       display: inline-block;
       padding-left: 3px;
     }
     .select2-container--default .select2-results__option[aria-selected=true] {
       background-color: #fff;
     }
     .select2-container--default .select2-results__option--highlighted[aria-selected] {
       background-color: #eaeaeb;
       color: #272727;
     }
     .select2-container--default .select2-selection--multiple {
       margin-bottom: 10px;
     }
     .select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple {
       border-radius: 4px;
     }
     .select2-container--default.select2-container--focus .select2-selection--multiple {
       border-color: #f77750;
       border-width: 2px;
     }
     .select2-container--default .select2-selection--multiple {
       border-width: 2px;
     }
     .select2-container--open .select2-dropdown--below {
       
       border-radius: 6px;
       box-shadow: 0 0 10px rgba(0,0,0,0.5);
       width: max-content !important;
     }
     .select2-selection .select2-selection--multiple:after {
       content: 'hhghgh';
     }
     /* select with icons badges single*/
     .select-icon .select2-selection__placeholder .badge {
       display: none;
     }
     .select-icon .placeholder {
       display: none;
     }
     .select-icon .select2-results__option:before,
     .select-icon .select2-results__option[aria-selected=true]:before {
       display: none !important;
       /* content: "" !important; */
     }
     .select-icon  .select2-search--dropdown {
       display: none;
     }



     .select2-container .select2-selection--single {
       height: 38px;
     }

     .logged-in {
       color: orange;
       font-size: 21px;
     }

     /* Hide expense type specific fields by default */
     .tyre-expense-fields,
     .mechanic-expense-fields {
       display: none;
     }

     /* Form styling improvements */
     .expense-section {
       background-color: #f8f9fa;
       border: 1px solid #e0e0e0;
       border-radius: 8px;
       padding: 20px;
       margin-bottom: 20px;
       transition: all 0.3s ease;
     }

     .expense-section:hover {
       box-shadow: 0 2px 8px rgba(0,0,0,0.1);
     }

     .section-title {
       color: #05386b;
       font-weight: 600;
       font-size: 16px;
       margin-bottom: 20px;
       padding-bottom: 10px;
       border-bottom: 2px solid #05386b;
       display: flex;
       align-items: center;
     }

     .section-title:before {
       content: "â–¸";
       margin-right: 10px;
       font-size: 18px;
     }

     .form-row-custom {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
       gap: 20px;
       margin-bottom: 15px;
     }

     .form-group {
       margin-bottom: 20px;
     }

     .form-group label {
       font-weight: 500;
       color: #333;
       margin-bottom: 8px;
       display: block;
     }

     .required-field {
       color: #dc3545;
       margin-left: 3px;
     }

     .form-control, .sele {
       border-radius: 6px;
       border: 1px solid #ced4da;
       transition: all 0.3s ease;
     }

     .form-control:focus, .sele:focus {
       border-color: #05386b;
       box-shadow: 0 0 0 0.2rem rgba(5, 56, 107, 0.25);
     }

     .help-text {
       font-size: 12px;
       color: #6c757d;
       margin-top: 5px;
       font-style: italic;
     }

     #payment-button {
       background-color: #05386b;
       border: none;
       padding: 12px 30px;
       font-weight: 500;
       transition: all 0.3s ease;
       margin-top: 20px;
     }

     #payment-button:hover {
       background-color: #042a52;
       transform: translateY(-2px);
       box-shadow: 0 4px 8px rgba(5, 56, 107, 0.3);
     }

     #payment-button:disabled {
       opacity: 0.6;
       cursor: not-allowed;
       transform: none;
     }

     .card-header {
       background-color: #05386b;
       color: white;
       border-radius: 8px 8px 0 0;
       padding: 15px 20px;
     }

     .card-header .card-title {
       color: white;
       margin: 0;
       font-size: 18px;
       font-weight: 600;
     }

</style>


{% endblock head %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <strong class="card-title">Add Truck Expense</strong>
            </div>
            <div class="card-body">
                <!-- Credit Card -->
                <div id="pay-invoice">
                    <div class="card-body">
                      <form id="expense_form" action="#" method="post" >
                            {% csrf_token %}

                            <!-- Basic Information Section -->
                            <div class="expense-section">
                                <div class="section-title">Basic Information</div>
                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="expense_type" class="control-label mb-1">
                                            Expense Type <span class="required-field">*</span>
                                        </label>
                                        {{ form.expense_type }}
                                    </div>

                                    <div class="form-group">
                                        <label for="truck" class="control-label mb-1">
                                            Truck <span class="required-field">*</span>
                                        </label>
                                        {{ form.truck }}
                                    </div>
                                </div>
                            </div>

                            <!-- Tyre Expense Fields -->
                            <div class="tyre-expense-fields expense-section">
                                <div class="section-title">Tyre Details</div>
                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="tyre_no" class="control-label mb-1">Tyre Number</label>
                                        {{ form.tyre_no }}
                                    </div>

                                    <div class="form-group">
                                        <label for="pattern" class="control-label mb-1">Pattern</label>
                                        {{ form.pattern }}
                                    </div>

                                    <div class="form-group">
                                        <label for="type" class="control-label mb-1">Type</label>
                                        {{ form.type }}
                                    </div>
                                </div>

                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="company" class="control-label mb-1">Company</label>
                                        {{ form.company }}
                                    </div>

                                    <div class="form-group">
                                        <label for="driver" class="control-label mb-1">Driver</label>
                                        {{ form.driver }}
                                    </div>
                                </div>
                            </div>

                            <!-- Mechanic/Spare Part Expense Fields -->
                            <div class="mechanic-expense-fields expense-section">
                                <div class="section-title">Mechanic & Spare Part Details</div>
                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="mechanic_name" class="control-label mb-1">Mechanic Name</label>
                                        {{ form.mechanic_name }}
                                    </div>

                                    <div class="form-group">
                                        <label for="spare_part_name" class="control-label mb-1">Spare Part Name</label>
                                        {{ form.spare_part_name }}
                                    </div>
                                </div>

                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="labour_cost" class="control-label mb-1">Labour Cost</label>
                                        {{ form.labour_cost }}
                                    </div>

                                    <div class="form-group">
                                        <label for="cost" class="control-label mb-1">Spare Part Cost</label>
                                        {{ form.cost }}
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="work_description" class="control-label mb-1">Work Description</label>
                                    {{ form.work_description }}
                                </div>
                            </div>

                            <!-- Payment & Additional Information Section -->
                            <div class="expense-section">
                                <div class="section-title">Payment & Additional Information</div>
                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="vendor" class="control-label mb-1">Vendor</label>
                                        {{ form.vendor }}
                                    </div>

                                    <div class="form-group">
                                        <label for="amount" class="control-label mb-1">
                                            Total Amount <span class="required-field">*</span>
                                        </label>
                                        {{ form.amount }}
                                        <small class="help-text" id="amount-hint-mechanic" style="display: none;">
                                            (Labour Cost + Spare Part Cost will be calculated automatically)
                                        </small>
                                    </div>
                                </div>

                                <div class="form-row-custom">
                                    <div class="form-group">
                                        <label for="entry_date" class="control-label mb-1">Entry Date</label>
                                        {{ form.entry_date }}
                                    </div>

                                    <div class="form-group">
                                        <label for="note" class="control-label mb-1">Note</label>
                                        {{ form.note }}
                                    </div>
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 30px;">
                                <button id="payment-button" type="submit" class="btn btn-lg btn-info">
                                    <span id="payment-button-amount">Submit Expense</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div> <!-- .card -->

    </div><!--/.col-->
</div>

{% endblock content %}

    {% block js %}

        <script>
            
            $('.sele').select2();

            // Function to toggle fields based on expense type
            function toggleExpenseFields() {
                var expenseType = $('#expense_type').val();
                
                // Hide all expense-specific fields first
                $('.tyre-expense-fields, .mechanic-expense-fields').hide();
                $('#amount-hint-mechanic').hide();
                
                // Show relevant fields based on expense type
                if (expenseType === 'tyre') {
                    $('.tyre-expense-fields').show();
                } else if (expenseType === 'mechanic') {
                    $('.mechanic-expense-fields').show();
                    $('#amount-hint-mechanic').show();
                }
            }

            // Initialize on page load
            $(document).ready(function() {
                toggleExpenseFields();
                
                // Toggle fields when expense type changes
                $('#expense_type').on('change', function() {
                    toggleExpenseFields();
                });

                // Auto-calculate total amount for mechanic expenses
                $('#labour_cost, #cost').on('input', function() {
                    if ($('#expense_type').val() === 'mechanic') {
                        var labourCost = parseFloat($('#labour_cost').val()) || 0;
                        var sparePartCost = parseFloat($('#cost').val()) || 0;
                        var total = labourCost + sparePartCost;
                        $('#amount').val(total.toFixed(2));
                    }
                });
            });

            // Prevent duplicate submissions
            $('#payment-button').on('click', function(e) {
                var submitButton = $(this);
                if (submitButton.prop('disabled')) {
                    e.preventDefault();
                    return false;
                }
                // Disable button after a small delay to allow form submission to proceed
                setTimeout(function() {
                    submitButton.prop('disabled', true);
                    $('#payment-button-amount').text('Submitting...');
                }, 10);
            });
        </script>

    {% endblock js %}
